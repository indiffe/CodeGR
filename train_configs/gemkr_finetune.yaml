# =========================================================q
# Model
# =========================================================
model:
  # å¯¹åº” @registry.register_model("gemkr_codebert_dsi")
  arch: gemkr_codebert_dsi
  model_type: gemkr_codebert_dsi

  # è¿™äº›å‚æ•°åœ¨ models/gemkr_codebert.yaml ä¸­å®šä¹‰
  # è¿™é‡Œåªå£°æ˜è®­ç»ƒé˜¶æ®µå¿…é¡»æ˜¾å¼æ§åˆ¶çš„é¡¹
  prefix_length: 16
  freeze_decoder: true
  enable_gradient_checkpointing: true


# =========================================================
# Datasetsï¼ˆçº¯æ–‡æœ¬ï¼ŒCoSQAï¼‰
# =========================================================
datasets:
  cosqa_dsi:
    data_path: "./dataset/CoSQA_std/train.json"

    text_processor:
      train:
        name: "codebert_text"
        pretrained_model_name: "/data/lizhen/CodeDSI/codebert-base"
        max_length: 512


# =========================================================
# Run / Task
# =========================================================
run:
  # å¯¹åº” DSIPretrainTask
  task: dsi_pretrain

  # =========================
  # Optimization
  # =========================
  lr_sched: "linear_warmup_cosine_lr"
  init_lr: 1e-4
  min_lr: 1e-6
  warmup_lr: 1e-7
  warmup_steps: 200

  weight_decay: 0.01
  max_epoch: 5
  iters_per_epoch: 2400

  # =========================
  # Batch / Loader
  # =========================
  batch_size_train: 1
  batch_size_eval: 1
  gradient_accumulation_steps: 2
  num_workers: 2

  # =========================
  # Runtime
  # =========================
  seed: 42
  output_dir: "output/gemkr_codebert_dsi"

  amp: true
  resume_ckpt_path: null

  evaluate: false
  train_splits: ["train"]

  device: "cuda"

  # =========================
  # ğŸ”´ å•å¡å…³é”®è®¾ç½®
  # =========================
  world_size: 1
  distributed: false
  dist_url: null

  # =========================
  # ğŸ”´ Checkpointï¼ˆå…³é”®ï¼šå¦åˆ™ä¸ä¼šä¿å­˜ï¼‰
  # =========================
  checkpoint:
    save_freq: 1        # æ¯ä¸ª epoch ä¿å­˜ä¸€æ¬¡
    save_last: true     # è®­ç»ƒç»“æŸä¿å­˜ last.pth
    save_best: false    # å½“å‰æ— éªŒè¯é›†ï¼Œå…³é—­
